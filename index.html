<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DONY BURGUERS SUPREME - JDP INDUSTRIAL</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { 
            --gold-18k: linear-gradient(145deg, #bf953f 0%, #fcf6ba 20%, #b38728 40%, #fcf6ba 60%, #aa771c 80%, #fcf6ba 100%);
            --gold-solid: #d4af37;
            --dark: #000;
            --shine-effect: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }
        body { background: var(--dark); color: var(--gold-solid); font-family: 'Arial Black', sans-serif; margin: 0; padding: 90px 3% 120px 3%; overflow-x: hidden; user-select: none; -webkit-user-select: none; }
        .header { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: #000; border-bottom: 3px solid var(--gold-solid); z-index: 1000; display: flex; justify-content: space-between; align-items: center; padding: 0 5%; }
        #secret-trigger { font-size: 22px; font-weight: 900; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #total-display { font-size: 26px; font-weight: 900; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: #050505; border: 1px solid #1a1a1a; border-radius: 10px; overflow: hidden; position: relative; height: 240px; }
        .card::after { content: ""; position: absolute; top: 0; left: -150%; width: 100%; height: 100%; background: var(--shine-effect); transform: skewX(-20deg); animation: resplandece 4s infinite; }
        @keyframes resplandece { 0% { left: -150%; } 20% { left: 150%; } 100% { left: 150%; } }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); padding: 12px 5px; text-align: center; z-index: 2; }
        .card-info h4 { margin: 0; font-size: 0.8rem; text-transform: uppercase; color: #fff; letter-spacing: 1px; }
        .card-info .price { font-weight: 900; font-size: 1.2rem; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-confirmar { position: fixed; bottom: 25px; left: 5%; width: 90%; background: var(--gold-18k); color: #000; padding: 20px; border: none; border-radius: 12px; font-weight: 900; font-size: 1.7rem; z-index: 1100; box-shadow: 0 0 30px rgba(184, 134, 11, 0.5); }
        #escritorio-jdp { display: none; position: fixed; inset: 0; background: #000; z-index: 10000; padding: 20px; flex-direction: column; overflow-y: auto; border: 4px solid var(--gold-solid); }
        .section { border: 1px solid var(--gold-solid); padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        input { width: 94%; background: #111; border: 1px solid #333; color: #fff; padding: 12px; margin: 5px 0; border-radius: 5px; }
        .btn-jdp { background: var(--gold-18k); color: #000; border: none; padding: 15px; width: 100%; font-weight: 900; border-radius: 5px; margin-top: 10px; }
        .item-gestao { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #222; gap: 10px; }
        .btn-del { background: #ff0000; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        #supreme-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .gold-title { font-size: 12vw; font-weight: 900; white-space: nowrap; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; position: absolute; transform: translateX(-150%); }
        .slide-active { animation: slidePass 1s ease-in-out 3; }
        @keyframes slidePass { 0% { transform: translateX(-150%); } 50% { transform: translateX(0%); } 100% { transform: translateX(150%); } }
        #flash-container { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; }
        #flash-img { max-width: 85%; border: 6px solid var(--gold-solid); box-shadow: 0 0 50px var(--gold-solid); }
        #final-resplendent { display: none; font-size: 13vw; font-weight: 900; text-align: center; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: pulseGold 2s infinite alternate; }
        @keyframes pulseGold { from { transform: scale(0.9); opacity: 0.8; } to { transform: scale(1.1); opacity: 1; } }
    </style>
</head>
<body>
    <div class="header"><div id="secret-trigger">DONY BURGUERS</div><div id="total-display">R$ 0,00</div></div>
    <div class="grid" id="vitrine"></div>
    <button class="btn-confirmar" onclick="iniciarSequenciaJDP()">CONFIRMAR PEDIDO</button>

    <div id="escritorio-jdp">
        <h1 style="text-align:center; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ESCRIT√ìRIO JDP</h1>
        <div class="section">
            <h3 style="color:var(--gold-solid)">CADASTRAR PRODUTO</h3>
            <input type="text" id="inp-nome" placeholder="Nome">
            <input type="number" id="inp-preco" placeholder="Pre√ßo">
            <input type="text" id="inp-link" placeholder="Link Imagem">
            <input type="number" id="inp-estoque" placeholder="Estoque">
            <button class="btn-jdp" onclick="salvarProduto()">SALVAR</button>
        </div>
        <div class="section"><h3 style="color:var(--gold-solid)">PLAYLIST MP3 (FIREBASE)</h3><div id="slots-audio"></div></div>
        <div class="section"><h3 style="color:var(--gold-solid)">GEST√ÉO</h3><div id="lista-gestao"></div></div>
        <button onclick="document.getElementById('escritorio-jdp').style.display='none'" class="btn-jdp" style="background:#333; color:#fff;">SAIR</button>
    </div>

    <div id="supreme-overlay">
        <div id="gold-anim" class="gold-title">DONY BURGUERS</div>
        <div id="flash-container"><img id="flash-img" src=""></div>
        <div id="final-resplendent">DONY BURGUERS</div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCEdXF7ScnMYz0Ce0OW-B_UJ8Bm5Pl9m8o", databaseURL: "https://dony-burguers-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let carrinho = [], produtos = [], processando = false;

        const trigger = document.getElementById('secret-trigger');
        let timerSecreto;
        trigger.addEventListener('touchstart', () => {
            timerSecreto = setTimeout(() => {
                if(prompt("SENHA JDP:") === "1234") { document.getElementById('escritorio-jdp').style.display = 'flex'; renderEstudio(); }
            }, 5000);
        });
        trigger.addEventListener('touchend', () => clearTimeout(timerSecreto));

        function salvarProduto() {
            const nome = document.getElementById('inp-nome').value, preco = document.getElementById('inp-preco').value, link = document.getElementById('inp-link').value, estoque = document.getElementById('inp-estoque').value;
            if(nome && preco && link) db.ref('cardapio_supreme').push({ nome, preco, link, estoque: parseInt(estoque) });
        }

        // --- NOVA FUN√á√ÉO DE √ÅUDIO NO FIREBASE ---
        async function renderEstudio() {
            const slotCont = document.getElementById('slots-audio'); slotCont.innerHTML = 'Carregando slots...';
            const snap = await db.ref('audio_supreme').get();
            const audiosNoBanco = snap.val() || {};
            
            slotCont.innerHTML = '';
            for(let i=1; i<=5; i++) {
                const temAudio = audiosNoBanco['slot_'+i];
                slotCont.innerHTML += `
                    <div class="item-gestao">
                        <span>√ÅUDIO ${i} ${temAudio ? 'üíé' : '‚ö™'}</span>
                        <input type="file" accept="audio/*" onchange="subirAudio(this, ${i})" style="width:80px">
                        ${temAudio ? `<button class="btn-del" style="background:#00f2ff;color:#000" onclick="ouvirAudio(${i})">‚ñ∂Ô∏è</button> <button class="btn-del" onclick="excluirAudio(${i})">üóëÔ∏è</button>` : ''}
                    </div>`;
            }
            document.getElementById('lista-gestao').innerHTML = produtos.map(p => `<div class="item-gestao"><span>${p.nome}</span><button class="btn-del" onclick="db.ref('cardapio_supreme').child('${p.id}').remove()">X</button></div>`).join('');
        }

        function subirAudio(input, i) {
            const file = input.files[0];
            if(file.size > 900000) return alert("√Åudio muito grande! Use um MP3 curto.");
            const reader = new FileReader();
            reader.onload = (e) => {
                db.ref('audio_supreme/slot_' + i).set(e.target.result).then(() => {
                    alert("√Åudio " + i + " salvo no Banco Supreme!");
                    renderEstudio();
                });
            };
            reader.readAsDataURL(file);
        }

        async function ouvirAudio(i) {
            const snap = await db.ref('audio_supreme/slot_' + i).get();
            if(snap.exists()) new Audio(snap.val()).play();
        }

        function excluirAudio(i) {
            db.ref('audio_supreme/slot_' + i).remove().then(() => renderEstudio());
        }

        db.ref('cardapio_supreme').on('value', snap => {
            const data = snap.val(); produtos = data ? Object.entries(data).map(([id, val]) => ({id, ...val})) : [];
            document.getElementById('vitrine').innerHTML = produtos.map(p => `<div class="card" onclick="add('${p.id}')"><img src="${p.link}"><div class="card-info"><h4>${p.nome}</h4><div class="price">R$ ${parseFloat(p.preco).toFixed(2)}</div></div></div>`).join('');
        });

        function add(id) {
            const p = produtos.find(x => x.id === id);
            if(p.estoque <= 0) return alert("Produto esgotado!");
            carrinho.push(p);
            document.getElementById('total-display').innerText = `R$ ${carrinho.reduce((acc, i) => acc + parseFloat(i.preco), 0).toFixed(2)}`;
        }

        async function iniciarSequenciaJDP() {
            if (carrinho.length === 0 || processando) return;
            processando = true;

            // --- MOTOR DE √ÅUDIO FIREBASE (EXECUTANDO) ---
            const snapAudios = await db.ref('audio_supreme').get();
            if(snapAudios.exists()) {
                const lista = Object.values(snapAudios.val());
                const snapIdx = await db.ref('rotation').get();
                let idx = (snapIdx.val() || 0) % lista.length;
                new Audio(lista[idx]).play().catch(e => console.log("Erro de autoplay"));
                db.ref('rotation').set((snapIdx.val() || 0) + 1);
            }

            const totalStr = document.getElementById('total-display').innerText;
            db.ref('PEDIDOS_PRODUCAO').push({ itens: carrinho, total: totalStr, data: new Date().toLocaleString() });
            
            for(let item of carrinho) db.ref('cardapio_supreme/' + item.id).update({ estoque: item.estoque - 1 });

            const overlay = document.getElementById('supreme-overlay'), goldAnim = document.getElementById('gold-anim'), flashBox = document.getElementById('flash-container'), flashImg = document.getElementById('flash-img'), finalRes = document.getElementById('final-resplendent');
            overlay.style.display = 'flex'; goldAnim.style.display = 'block'; goldAnim.classList.add('slide-active');
            await new Promise(r => setTimeout(r, 3000));
            goldAnim.style.display = 'none'; flashBox.style.display = 'flex';
            for (let p of produtos) { flashImg.src = p.link; await new Promise(r => setTimeout(r, 150)); }
            flashBox.style.display = 'none'; finalRes.style.display = 'block';
            await new Promise(r => setTimeout(r, 4000));
            overlay.style.display = 'none'; finalRes.style.display = 'none';
            goldAnim.classList.remove('slide-active');
            carrinho = []; document.getElementById('total-display').innerText = "R$ 0,00"; processando = false;
        }

        document.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(() => {});
            }
        }, {once: true});
    </script>
</body>
</html>
